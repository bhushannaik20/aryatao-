<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UrjaShakti</title>
  <!-- Include Tailwind CSS via CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* Custom CSS for animations and other styles */
    @keyframes fadeInUp {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.8s forwards;
    }

    .delay-300 {
      animation-delay: 0.3s;
    }

    .delay-600 {
      animation-delay: 0.6s;
    }

    .delay-1000 {
      animation-delay: 1s;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }

    .animate-fade-in {
      animation: fadeIn 0.8s forwards;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    .animate-bounce {
      animation: bounce 2s infinite;
    }

    .aspect-w-16.aspect-h-9 {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 9 / 16 = 0.5625 */
    }

    .aspect-w-16.aspect-h-9 > * {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .hidden-appliance-fields {
      display: none;
    }
  </style>
</head>
<body class="min-h-screen bg-white text-gray-900 font-sans">
  <!-- Navigation -->
  <nav id="navbar" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-white shadow-md">
    <div class="container mx-auto px-6 py-4">
      <div class="flex justify-between items-center">
        <a href="#" class="text-2xl font-semibold">UrjaShakti</a>
        <div class="space-x-8">
          <a href="#" class="hover:text-blue-600 transition-colors">Home</a>
          <a href="#" class="hover:text-blue-600 transition-colors">Products</a>
          <a href="#" class="hover:text-blue-600 transition-colors">Support</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="pt-24 pb-12 px-6 text-center bg-gradient-to-b from-gray-50 to-white">
    <div class="animate-fade-in-up">
      <h1 class="text-5xl md:text-6xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-green-500">
        Power Your World
      </h1>
      <p class="max-w-2xl mx-auto text-xl text-gray-600 mb-12">
        Transform your rooftop into a sustainable energy powerhouse with our cutting-edge solar solutions.
      </p>
    </div>
    <div class="max-w-5xl mx-auto mb-12 animate-fade-in-up delay-300">
      <img
        src="C:/Users/Pranav/Downloads/SOLAR/OG/img.jpg"
        alt="Solar panels on a modern house"
        class="rounded-2xl shadow-2xl w-full h-auto object-cover"
      />
    </div>
    <div class="max-w-lg mx-auto animate-fade-in-up delay-600">
      <div class="flex gap-2 bg-white p-2 rounded-full shadow-lg">
        <input 
          id="location-input"
          type="text" 
          placeholder="Enter your location" 
          class="flex-grow rounded-full border border-gray-300 focus:border-gray-500 focus:ring-0 bg-white text-gray-700 px-6 py-3 outline-none"
        />
        <button id="search-btn" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full px-6 py-3">
          Calculate
        </button>
      </div>
    </div>
    <div class="mt-12 animate-fade-in delay-1000">
      <!-- ChevronDownIcon -->
      <svg class="w-8 h-8 mx-auto text-gray-400 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
  </section>

  <!-- Map Section -->
  <section class="py-24 px-6 bg-gray-50">
    <div class="max-w-6xl mx-auto">
      <h2 class="text-4xl font-bold mb-12 text-center">Visualize Your Solar Potential</h2>
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <!-- Map Container -->
        <div id="map" class="w-full" style="height: 600px;"></div>
      </div>
    </div>
  </section>

  <!-- Results Section -->
  <section class="py-24 px-6 bg-white">
    <div class="max-w-6xl mx-auto">
      <h2 class="text-4xl font-bold mb-12 text-center">Your Solar System Snapshot</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- First Card (Area) -->
        <div class="bg-gradient-to-br from-blue-50 to-green-50 border-none shadow-xl rounded-lg">
          <div class="flex flex-col items-center justify-center p-8">
            <!-- AREA Icon -->
            <svg class="w-16 h-16 text-blue-600 mb-6" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 5V19C3 20.103 3.897 21 5 21H19C20.103 21 21 20.103 21 19V5C21 3.897 20.103 3 19 3H5C3.897 3 3 3.897 3 5ZM19.002 19H5V5H19L19.002 19Z" fill="currentColor"/>
              <path d="M15 12H17V7H12V9H15V12ZM12 15H9V12H7V17H12V15Z" fill="currentColor"/>
            </svg>
            <h3 class="text-2xl font-semibold mb-2">Roof Area</h3>
            <p id="area-result" class="text-4xl font-bold text-blue-700">0 m²</p>
          </div>
        </div>
        <!-- Second Card (Irradiance) -->
        <div class="bg-gradient-to-br from-yellow-50 to-orange-50 border-none shadow-xl rounded-lg">
          <div class="flex flex-col items-center justify-center p-8">
            <!-- SUN Icon -->
            <svg class="w-16 h-16 text-yellow-500 mb-6" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C12.2652 2 12.5196 2.10536 12.7071 2.29289C12.8946 2.48043 13 2.73478 13 3V4C13 4.26522 12.8946 4.51957 12.7071 4.70711C12.5196 4.89464 12.2652 5 12 5C11.7348 5 11.4804 4.89464 11.2929 4.70711C11.1054 4.51957 11 4.26522 11 4V3C11 2.73478 11.1054 2.48043 11.2929 2.29289C11.4804 2.10536 11.7348 2 12 2ZM19.071 4.929C19.2585 5.11653 19.3638 5.37084 19.3638 5.636C19.3638 5.90116 19.2585 6.15547 19.071 6.343L18.364 7.05C18.2718 7.14551 18.1614 7.22169 18.0394 7.2741C17.9174 7.32651 17.7862 7.3541 17.6534 7.35525C17.5206 7.3564 17.3889 7.3311 17.266 7.28082C17.1432 7.23054 17.0315 7.15629 16.9376 7.0624C16.8437 6.9685 16.7695 6.85685 16.7192 6.73395C16.6689 6.61106 16.6436 6.47938 16.6447 6.3466C16.6459 6.21382 16.6735 6.0826 16.7259 5.9606C16.7783 5.83859 16.8545 5.72825 16.95 5.636L17.657 4.929C17.8445 4.74153 18.0988 4.63621 18.364 4.63621C18.6292 4.63621 18.8835 4.74153 19.071 4.929ZM4.929 4.929C5.11653 4.74153 5.37084 4.63621 5.636 4.63621C5.90116 4.63621 6.15547 4.74153 6.343 4.929L7.05 5.636C7.23216 5.8246 7.33295 6.0772 7.33067 6.3394C7.3284 6.6016 7.22323 6.85241 7.03782 7.03782C6.85241 7.22323 6.6016 7.3284 6.3394 7.33067C6.0772 7.33295 5.8246 7.23216 5.636 7.05L4.929 6.343C4.74153 6.15547 4.63621 5.90116 4.63621 5.636C4.63621 5.37084 4.74153 5.11653 4.929 4.929ZM12 8C10.9391 8 9.92172 8.42143 9.17157 9.17157C8.42143 9.92172 8 10.9391 8 12C8 13.0609 8.42143 14.0783 9.17157 14.8284C9.92172 15.5786 10.9391 16 12 16C13.0609 16 14.0783 15.5786 14.8284 14.8284C15.5786 14.0783 16 13.0609 16 12C16 10.9391 15.5786 9.92172 14.8284 9.17157C14.0783 8.42143 13.0609 8 12 8ZM6 12C6 10.4087 6.63214 8.88258 7.75736 7.75736C8.88258 6.63214 10.4087 6 12 6C13.5913 6 15.1174 6.63214 16.2426 7.75736C17.3679 8.88258 18 10.4087 18 12C18 13.5913 17.3679 15.1174 16.2426 16.2426C15.1174 17.3679 13.5913 18 12 18C10.4087 18 8.88258 17.3679 7.75736 16.2426C6.63214 15.1174 6 13.5913 6 12ZM2 12C2 11.7348 2.10536 11.4804 2.29289 11.2929C2.48043 11.1054 2.73478 11 3 11H4C4.26522 11 4.51957 11.1054 4.70711 11.2929C4.89464 11.4804 5 11.7348 5 12C5 12.2652 4.89464 12.5196 4.70711 12.7071C4.51957 12.8946 4.26522 13 4 13H3C2.73478 13 2.48043 12.8946 2.29289 12.7071C2.10536 12.5196 2 12.2652 2 12ZM19 12C19 11.7348 19.1054 11.4804 19.2929 11.2929C19.4804 11.1054 19.7348 11 20 11H21C21.2652 11 21.5196 11.1054 21.7071 11.2929C21.8946 11.4804 22 11.7348 22 12C22 12.2652 21.8946 12.5196 21.7071 12.7071C21.5196 12.8946 21.2652 13 21 13H20C19.7348 13 19.48043 12.8946 19.2929 12.7071C19.1054 12.5196 19 12.2652 19 12ZM5.636 16.95C5.8246 16.7678 6.0772 16.667 6.3394 16.6693C6.6016 16.6716 6.85241 16.7768 7.03782 16.9622C7.22323 17.1476 7.3284 17.3984 7.33067 17.6606C7.33295 17.9228 7.23216 18.1754 7.05 18.364L6.343 19.071C6.1544 19.2532 5.9018 19.354 5.6396 19.3517C5.3774 19.3494 5.12659 19.2442 4.94118 19.0588C4.75577 18.8734 4.6506 18.6226 4.64833 18.3604C4.64605 18.0982 4.74684 17.8456 4.929 17.657L5.636 16.95ZM16.95 18.364C16.7678 18.1754 16.667 17.9228 16.6693 17.6606C16.6716 17.3984 16.7768 17.1476 16.9622 16.9622C17.1476 16.7768 17.3984 16.6716 17.6606 16.6693C17.9228 16.667 18.1754 16.7678 18.364 16.95L19.071 17.657C19.2532 17.8456 19.354 18.0982 19.3517 18.3604C19.3494 18.6226 19.2442 18.8734 19.0588 19.0588C18.8734 19.2442 18.6226 19.3494 18.3604 19.3517C18.0982 19.354 17.8456 19.2532 17.657 19.071L16.95 18.364ZM12 19C12.2652 19 12.5196 19.1054 12.7071 19.2929C12.8946 19.4804 13 19.7348 13 20V21C13 21.2652 12.8946 21.5196 12.7071 21.7071C12.5196 21.8946 12.2652 22 12 22C11.7348 22 11.4804 21.8946 11.2929 21.7071C11.1054 21.5196 11 21.2652 11 21V20C11 19.7348 11.1054 19.4804 11.2929 19.2929C11.4804 19.1054 11.7348 19 12 19Z" fill="currentColor"/>
            </svg>
            <h3 class="text-2xl font-semibold mb-2">Solar Irradiance</h3>
            <p id="irradiance-result" class="text-4xl font-bold text-yellow-600">0 kWh/m²</p>
          </div>
        </div>
        <!-- Third Card (Capacity) -->
        <div class="bg-gradient-to-br from-green-50 to-teal-50 border-none shadow-xl rounded-lg">
          <div class="flex flex-col items-center justify-center p-8">
            <!-- CAPACITY Icon -->
            <svg class="w-16 h-16 text-green-500 mb-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13 10V3L4 14H11V21L20 10H13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h3 class="text-2xl font-semibold mb-2">System Capacity</h3>
            <p id="capacity-result" class="text-4xl font-bold text-green-600">0 kWh</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-24 px-6 bg-gradient-to-r from-blue-600 to-green-500 text-white">
    <div class="max-w-4xl mx-auto text-center">
      <h2 class="text-4xl font-bold mb-6">Ready to Embrace Solar?</h2>
      <p class="text-xl mb-12">Join thousands of homeowners who have already made the switch to clean, renewable energy.</p>
      <button id="get-started-btn" class="bg-white text-blue-600 hover:bg-gray-100 text-lg px-8 py-3 rounded-full">
        Get Started
      </button>
    </div>
  </section>

  <!-- Hidden Section for Electricity Bill and Appliances -->
  <section id="hidden-sections" class="hidden py-24 px-6 bg-white text-gray-900">
    <div class="max-w-6xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Electricity Bill Section -->
        <div class="bg-gray-100 p-6 rounded-lg shadow-md">
          <h2 class="text-4xl font-bold mb-6 text-center">I Know My Electricity Bill</h2>
          <form id="electricity-bill-form" class="text-left">
            <!-- Monthly Electricity Bill -->
            <div class="mb-6">
              <label for="monthly-bill" class="block text-lg font-medium text-gray-700">Monthly electricity bill *</label>
              <input
                type="number"
                id="monthly-bill"
                name="monthly-bill"
                required
                placeholder="Enter amount in ₹"
                class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-blue-200 focus:border-blue-500"
              />
              <span class="text-sm text-red-500 mt-1">This field is required</span>
            </div>
            
            <!-- Number of People -->
            <div class="mb-6">
              <label for="num-people" class="block text-lg font-medium text-gray-700">Number of people *</label>
              <input
                type="number"
                id="num-people"
                name="num-people"
                required
                placeholder="Enter number of people in your household"
                class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-blue-200 focus:border-blue-500"
              />
              <span class="text-sm text-red-500 mt-1">This field is required</span>
            </div>

            <!-- UPS Backup -->
            <div class="mb-6">
              <label class="block text-lg font-medium text-gray-700 mb-3">Do you have UPS for power back-up?</label>
              <div class="flex items-center space-x-6">
                <label class="inline-flex items-center">
                  <input type="radio" name="ups-backup" value="yes" class="form-radio text-blue-600">
                  <span class="ml-2 text-gray-700">Yes</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="radio" name="ups-backup" value="no" class="form-radio text-blue-600">
                  <span class="ml-2 text-gray-700">No</span>
                </label>
              </div>
            </div>
          </form>
        </div>

        <!-- Appliances Section -->
        <div class="bg-gray-100 p-6 rounded-lg shadow-md">
          <h2 class="text-4xl font-bold mb-6 text-center">Regular Appliances Usage</h2>
          <form id="appliance-form" class="text-left">
            <!-- Regular Appliances -->
            <div class="mb-6">
              <label class="block text-lg font-medium text-gray-700 mb-3">Regular Appliances</label>
              <div class="space-y-2">
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Lights (Bulb)" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Lights (Bulb)</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Lights (CFL)" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Lights (CFL)</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Lights (LED)" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Lights (LED)</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Tube lights" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Tube lights</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Fans" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Fans</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="TV" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">TV</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Kitchen Appliances" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Kitchen Appliances</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Desktop PCs" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Desktop PCs</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Laptops" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Laptops</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Servers" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Servers</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="IT peripherals" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">IT peripherals</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="appliances" value="Printers/Fax/Copiers" class="form-checkbox text-blue-600 appliance-checkbox">
                  <span class="ml-2 text-gray-700">Printers/Fax/Copiers</span>
                </label>
              </div>
            </div>

            <!-- Hidden Quantity and Watt fields (shown dynamically when appliance is selected) -->
            <div id="appliance-fields-container" class="hidden-appliance-fields mb-6">
              <label for="appliance-qty" class="block text-lg font-medium text-gray-700">Quantity</label>
              <input
                type="number"
                id="appliance-qty"
                name="appliance-qty"
                placeholder="Enter quantity"
                class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-blue-200 focus:border-blue-500"
              />

              <label for="appliance-watts" class="block text-lg font-medium text-gray-700 mt-4">Watts per Appliance</label>
              <input
                type="number"
                id="appliance-watts"
                name="appliance-watts"
                placeholder="Enter wattage"
                class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring focus:ring-blue-200 focus:border-blue-500"
              />
            </div>

            <!-- Calculate Button -->
            <div class="text-center">
              <button id="calculate-usage" class="bg-blue-600 text-white px-6 py-3 rounded-full hover:bg-blue-700 transition-all">
                Calculate Daily Usage
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12 px-6">
    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-semibold mb-4">UrjaShakti</h3>
        <p class="text-gray-400">Empowering the world with sustainable energy solutions.</p>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-4">Products</h4>
        <ul class="space-y-2 text-gray-400">
          <li><a href="#" class="hover:text-white transition-colors">Solar Panels</a></li>
          <li><a href="#" class="hover:text-white transition-colors">Inverters</a></li>
          <li><a href="#" class="hover:text-white transition-colors">Battery Storage</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2 text-gray-400">
          <li><a href="#" class="hover:text-white transition-colors">FAQs</a></li>
          <li><a href="#" class="hover:text-white transition-colors">Contact Us</a></li>
          <li><a href="#" class="hover:text-white transition-colors">Installation Guide</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-4">Legal</h4>
        <ul class="space-y-2 text-gray-400">
          <li><a href="#" class="hover:text-white transition-colors">Privacy Policy</a></li>
          <li><a href="#" class="hover:text-white transition-colors">Terms of Service</a></li>
          <li><a href="#" class="hover:text-white transition-colors">Warranty Information</a></li>
        </ul>
      </div>
    </div>
    <div class="mt-12 text-center text-gray-400">
      <p>&copy; 2024 UrjaShakti. All rights reserved.</p>
    </div>
  </footer>

  <!-- Google Maps API script with drawing, places, and geometry libraries -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDusy8WBjxI0W_S0EOsMuyTthLv8owJDDA&libraries=drawing,places,geometry&callback=initMap"
  async defer></script>

  <!-- Include custom JavaScript -->
  <script>
    // Navbar scroll effect
    window.addEventListener('scroll', function() {
      var navbar = document.getElementById('navbar');
      if (window.scrollY > 50) {
        navbar.classList.add('shadow-md');
        navbar.classList.remove('bg-transparent');
      } else {
        navbar.classList.remove('shadow-md');
        navbar.classList.add('bg-transparent');
      }
    });

    let map;
    let drawingManager;
    let selectedShape = null;
    let geocoder;
    let searchMarker;

    // Map styles to hide points of interest
    const mapStyles = [
        {
            featureType: 'poi',
            stylers: [{ visibility: 'off' }],
        },
        {
            featureType: 'transit',
            stylers: [{ visibility: 'off' }],
        },
        {
            featureType: 'water',
            stylers: [{ color: '#aadaff' }],
        },
    ];

    // Initialize the map
    function initMap() {
        const center = { lat: 20, lng: 0 };

        // Create the map
        map = new google.maps.Map(document.getElementById('map'), {
            center: center,
            zoom: 2,
            styles: mapStyles, // Apply the custom styles
        });

        // Initialize geocoder for address lookup
        geocoder = new google.maps.Geocoder();

        // Initialize the Drawing Manager
        drawingManager = new google.maps.drawing.DrawingManager({
            drawingMode: google.maps.drawing.OverlayType.POLYGON,
            drawingControl: true,
            drawingControlOptions: {
                position: google.maps.ControlPosition.TOP_CENTER,
                drawingModes: ['polygon'],
            },
            polygonOptions: {
                editable: true,
                draggable: true,
            },
        });

        // Add the Drawing Manager to the map
        drawingManager.setMap(map);

        // Add event listener for when a new shape is drawn
        google.maps.event.addListener(drawingManager, 'overlaycomplete', function (event) {
            if (selectedShape) {
                selectedShape.setMap(null);  // Remove the previously selected shape
            }
            selectedShape = event.overlay;
            drawingManager.setDrawingMode(null);  // Disable drawing after shape is drawn

            setSelection(selectedShape);  // Set the newly drawn shape as selected
            addShapeListeners(selectedShape);  // Add event listeners for the new shape
            calculateArea();  // Calculate the area of the new shape
        });

        // Search functionality
        document.getElementById('search-btn').addEventListener('click', geocodeAddress);
    }

    // Smooth zoom function
    function smoothZoom(map, targetZoom, currentZoom) {
        if (currentZoom >= targetZoom) {
            return;
        } else {
            google.maps.event.addListenerOnce(map, 'zoom_changed', function () {
                smoothZoom(map, targetZoom, currentZoom + 1);
            });
            setTimeout(function () {
                map.setZoom(currentZoom);
            }, 80); // Adjust the delay for smoother or faster zoom
        }
    }

    // Function to clear the selection
    function clearSelection() {
        if (selectedShape) {
            selectedShape.setEditable(false);
            selectedShape = null;
        }
    }

    // Function to set a selected shape
    function setSelection(shape) {
        clearSelection();
        selectedShape = shape;
        shape.setEditable(true);
    }

    // Function to add listeners to a drawn shape
    function addShapeListeners(shape) {
        google.maps.event.addListener(shape, 'click', function () {
            setSelection(shape);
        });
        google.maps.event.addListener(shape.getPath(), 'set_at', calculateArea);
        google.maps.event.addListener(shape.getPath(), 'insert_at', calculateArea);
    }

    // Function to calculate the area of the selected shape
    async function calculateArea() {
        if (!selectedShape) return;

        const area = google.maps.geometry.spherical.computeArea(selectedShape.getPath());  // Calculate area in square meters
        console.log('Calculated Area (m²):', area);  // Log the calculated area for debugging

        // Update the area result
        document.getElementById('area-result').textContent = area.toFixed(2) + ' m²';

        // Proceed to calculate the system capacity
        await calculateSolarCapacity(area);
    }

    // Function to calculate the estimated solar capacity based on the area
    async function calculateSolarCapacity(area) {
        if (!selectedShape) return;

        const path = selectedShape.getPath();
        const centroid = getPolygonCentroid(path);

        const latitude = centroid.lat();
        const longitude = centroid.lng();

        // Get solar irradiance data from NASA's API
        const irradiance = await getSolarIrradiance(latitude, longitude);

        // Update the irradiance result
        document.getElementById('irradiance-result').textContent = irradiance.toFixed(2) + ' kWh/m²';

        const panelEfficiency = 0.18;  // 18% efficiency
        const coverageRatio = 0.8;  // 80% of the area can be covered with panels

        const totalPanelArea = area * coverageRatio;  // Total panel area in square meters

        const dailyEnergyProduction = totalPanelArea * panelEfficiency * irradiance;  // Energy production in kWh/day

        console.log('Total Panel Area (m²):', totalPanelArea);
        console.log('Estimated Daily Energy Production (kWh/day):', dailyEnergyProduction);

        // Update the capacity result
        document.getElementById('capacity-result').textContent = dailyEnergyProduction.toFixed(2) + ' kWh';
    }

    // Function to get the centroid of a polygon
    function getPolygonCentroid(path) {
        let latSum = 0;
        let lngSum = 0;
        const numPoints = path.getLength();
        for (let i = 0; i < numPoints; i++) {
            const point = path.getAt(i);
            latSum += point.lat();
            lngSum += point.lng();
        }
        return new google.maps.LatLng(latSum / numPoints, lngSum / numPoints);
    }

    // Function to get solar irradiance data from NASA's API
    function getSolarIrradiance(latitude, longitude) {
        return new Promise((resolve, reject) => {
            const parameters = 'ALLSKY_SFC_SW_DWN';  // Solar irradiance parameter
            const apiUrl = `https://power.larc.nasa.gov/api/temporal/climatology/point?parameters=${parameters}&community=RE&longitude=${longitude}&latitude=${latitude}&format=JSON`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    // Parse the data to get the irradiance value
                    const monthlyData = data.properties.parameter.ALLSKY_SFC_SW_DWN;
                    let totalIrradiance = 0;
                    let months = 0;
                    for (let month in monthlyData) {
                        totalIrradiance += monthlyData[month];
                        months++;
                    }
                    const averageIrradiance = totalIrradiance / months;
                    resolve(averageIrradiance);
                })
                .catch(error => {
                    console.error('Error fetching irradiance data:', error);
                    reject(error);
                });
        });
    }

    // Function for geocoding the address entered in the search box
    function geocodeAddress() {
        const address = document.getElementById('location-input').value;

        if (!address) {
            alert('Please enter a location.');
            return;
        }

        geocoder.geocode({ address: address }, function (results, status) {
            if (status === 'OK') {
                const location = results[0].geometry.location;

                // Remove the existing marker if any
                if (searchMarker) {
                    searchMarker.setMap(null);
                }

                // Place a new marker at the searched location
                searchMarker = new google.maps.Marker({
                    map: map,
                    position: location,
                });

                // Pan to the searched location
                map.panTo(location);

                // Start smooth zoom
                const currentZoom = map.getZoom();
                const targetZoom = 22; // Desired zoom level
                smoothZoom(map, targetZoom, currentZoom);

            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }

    // Show the hidden sections (Electricity Bill and Appliances) when the "Get Started" button is clicked
    document.getElementById('get-started-btn').addEventListener('click', function() {
      var hiddenSections = document.getElementById('hidden-sections');
      hiddenSections.classList.remove('hidden');
      hiddenSections.scrollIntoView({ behavior: 'smooth' });
    });

    // Show quantity and wattage inputs when an appliance is selected
    const applianceCheckboxes = document.querySelectorAll('.appliance-checkbox');
    const applianceFieldsContainer = document.getElementById('appliance-fields-container');
    
    applianceCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        if (this.checked) {
          applianceFieldsContainer.style.display = 'block';  // Show quantity and wattage fields
        } else {
          const anyChecked = [...applianceCheckboxes].some(c => c.checked);
          if (!anyChecked) {
            applianceFieldsContainer.style.display = 'none';  // Hide fields if none selected
          }
        }
      });
    });

    // Calculate daily usage when "Calculate" button is clicked
    document.getElementById('calculate-usage').addEventListener('click', function(event) {
      event.preventDefault();
      
      const qty = document.getElementById('appliance-qty').value;
      const watts = document.getElementById('appliance-watts').value;
      
      if (!qty || !watts) {
        alert("Please enter both quantity and wattage.");
        return;
      }
      
      const dailyUsage = qty * watts * 24 / 1000;  // Calculate in kWh
      alert(`Your daily usage is: ${dailyUsage.toFixed(2)} kWh`);
    });
  </script>
</body>
</html>
